{% extends 'base.html' %}

{% block content %}
<script type="text/javascript" src="../static/key2charname.js"></script>

<script>


    function clickModal(){
      var controlSchemeIsDefined = $.getJSON('/iscontrolschemedefined', {
        csrfmiddlewaretoken: '{{ csrf_token }}',
      }, function(data) {
          console.log(data.result);
          //Data.result is true, if the control scheme is defined. 
          if (data.result){
            window.location.pathname = '/corpus';
          } 
          else{
            openKeyboardControlsModal()
          }
      });
    }

    function openKeyboardControlsModal(){
      var loginModal = document.querySelector('#modal1');
      var loginModal_options = {};
      var loginModal_instance = M.Modal.init( loginModal, loginModal_options);

      console.log(loginModal_instance);
      loginModal_instance.open();

      var instance = M.Modal.getInstance(loginModal);
      instance.open();
    }

    function clickSettingsModal(){
      var loginModal = document.querySelector('#modal_settings');
      var loginModal_options = {};
      var loginModal_instance = M.Modal.init( loginModal, loginModal_options);

      console.log(loginModal_instance);
      loginModal_instance.open();

      var instance = M.Modal.getInstance(loginModal);
      instance.open();
    }

    function openCreationModal(){
      var loginModal = document.querySelector('#modal_create_control_scheme');
      var loginModal_options = {};
      var loginModal_instance = M.Modal.init( loginModal, loginModal_options);

      console.log(loginModal_instance);
      loginModal_instance.open();

      var instance = M.Modal.getInstance(loginModal);
      instance.open();
    }


/*
    $.getJSON('/iscontrolschemedefined', {
        ops: outputs,
      }, function(data) {
          console.log(data.result)
      })
*/

    function getStatus(input){      
      searchRequest =  $.post('/set_keyboard_controls', {
          csrfmiddlewaretoken: '{{ csrf_token }}',
          keyboardControlScheme: input,
        }, function(data) {
          console.log("WE DONE BOYS!!")
          window.location.pathname = '/corpus'
          return data;
        });
    }

    function fillTextArea(address, value){
      console.log(address)
      document.getElementById(address).value = key2char(value);
    }
    var highlightedID = ""

    function setHighlightedID(newValue){
      highlightedID = newValue
    }

    $("div").on('keydown', function(e){
      var keyCode = e.keyCode || e.which;
      e.preventDefault();
      console.log("We pressed Keycode: ", keyCode)
      fillTextArea(highlightedID, keyCode)
    })




  
</script>

<div class="card teal lighten-4">
    <div class="card-content">
      <div class="row">
          <h4>Welcome, {{ request.user.translator.name }}</h4>
          <h5>
            Translation Languages:
          </h5>
          <ul>
          {% for langpairs in request.user.translator.translatorlangs.all %}
            <li>{{ langpairs.langtolang }}</li>
          {% endfor %}

          <!--p>Translator: </p>
          <p>{{ request.user.translator.translatorconfigs }}</p-->

          Welcome to the Translation Study! We are excited to have you!!!
          </ul>
      </div>
    </div>  
</div>


<div class="card outline teal lighten-4">
    <div class="card-content centered">
      <div class="row">
          <h4>Instruction Video</h4>
          <iframe width="560" height="315" src="https://www.youtube.com/embed/DHan93R8d84" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
         
          <ul>
            <li>Translate Story 1</li>
            <li>Translate Story 2</li>
            <li>Translate Story 3</li>

          <ul>
      </div>
    </div>  
</div>

<div class="row">
  <div class="col s4">
    <div class="card teal lighten-4">
        <div class="card-content centered">

          <i class="material-icons Large">import_contacts</i>
          <p>Instructions</p>
        </div>
    </div>
  </div>
  <div class="col s4">
    <div class="card teal lighten-4" onclick="clickModal()">
      <div class="card-content centered">
        <i class="material-icons Large">play_arrow</i>
        <p>Get Started</p>
      </div>
    </div>
  </div>
  <div class="col s4">
    <div class="card teal lighten-4 modal-trigger" onclick="clickSettingsModal()">
        <div class="card-content centered">
          <i class="material-icons Large">keyboard</i>
          <p>Keyboard Control Settings</p>
        </div>
    </div>
  </div>
</div>

<!-- Pop Up Select Keyboard Layout Modals -->
<div id="modal1" class="modal">
  <div class="modal-content centered">
    <h4>Please select a keyboard control scheme for your session</h4>
      <ul>
      {% for config in request.user.translator.translatorconfigs.all %}
        <li><button class="waves-red waves-effect btn" onclick="getStatus('{{config.customKeyboardCommands}}')">{{ config.customKeyboardCommands }}</button></li>
        <br/>
      {% endfor %}
      </ul>
  </div>
</div>

<!-- Select and Define keyboard settings -->
<div id="modal_settings" class="modal">
    <div class="modal-content centered">
      <h4>Keyboard Settings</h4>
      <ul>
        <li><button class="waves-red waves-effect btn" onclick="openCreationModal()">Create New Keyboard Control Scheme</button></li>
        <br/>
        <li><button class="waves-red waves-effect btn" onclick="openKeyboardControlsModal()">Change Current Keyboard Control Scheme</button></li>
      </ul>
    </div>
  </div>


<div id="modal_create_control_scheme" class="modal">
  <div class="modal-content" onclick="console.log('UNHIGHLIGHTED')">
    <div class = "row">
      <form class = "col s12">
        <h4>Set Up A Custrom Control Scheme</h4>

        <p></p>
      
        <div class = "row">
            <div class = "input-field col s12 keylistener">
              <i class = "material-icons prefix">mode_edit</i>
              <textarea onclick="setHighlightedID('address1')" id="address1" class = "materialize-textarea keylistener"></textarea>
              <label for = "address">Select Entire Suggestion (Default Key: Enter)</label>
            </div>
        </div>

        <div class = "row">
            <div class = "input-field col s12 keylistener">
              <i class = "material-icons prefix">mode_edit</i>
              <textarea onclick="setHighlightedID('address2')" id = "address2" class = "materialize-textarea keylistener"></textarea>
              <label for = "address">Select Single Word from Suggestion (Default Key: Tab)</label>
            </div>
        </div>

        <div class = "row">
            <div class = "input-field col s12 keylistener">
              <i class = "material-icons prefix">mode_edit</i>
              <textarea onclick="setHighlightedID('address3')" id = "address3" class = "materialize-textarea keylistener"></textarea>
              <label for = "address">Highlight Next Suggestion (Default Key: Down Arrow)</label>
            </div>
        </div>

        <div class = "row">
            <div class = "input-field col s12 keylistener">
              <i class = "material-icons prefix">mode_edit</i>
              <textarea onclick="setHighlightedID('address4')" id = "address4" class = "materialize-textarea keylistener"></textarea>
              <label for = "address">Highlight Previous Suggestion (Default Key: Up Arrow)</label>
            </div>
        </div>

        <div class = "row">
            <div class = "input-field col s12 keylistener">
              <i class = "material-icons prefix">mode_edit</i>
              <textarea onclick="setHighlightedID('address5')" id ="address5" class = "materialize-textarea keylistener"></textarea>
              <label for = "address">Navigate To Next Corpus Fragment (Default Key: Page Down)</label>
            </div>
        </div>
        <div class = "row">
            <div class = "input-field col s12 keylistener">
              <i class = "material-icons prefix">mode_edit</i>
              <textarea onclick="setHighlightedID('address6')" id = "address6" class = "materialize-textarea keylistener"></textarea>
              <label for = "address">Navigate To Previous Corpus Fragment (Default Key: Page Up)</label>
            </div>
        </div>
        <div class = "row">
            <div class = "input-field col s12 keylistener">
              <i class = "material-icons prefix">mode_edit</i>
              <textarea onclick="setHighlightedID('address7')" id = "address7" class = "materialize-textarea keylistener"></textarea>
              <label for = "address">Submit Translation (Default Key: End)</label>
            </div>
        </div>    
        <Span>
          <i class = "material-icons prefix">mode_edit</i>
          <textarea onclick="setHighlightedID('address7')" id = "address7" class = "materialize-textarea"></textarea>
          <label for = "address">Control Scheme Name</label>
        </Span>
      </form>               
    <button onclick="fillTextArea()">submit</button>

  </div>
</div>
</div>



<!--Specify Keyboard Layout Form!!!!!-->

{% endblock  %}


<style>
  .box{
    color: brown;
    background-color: blue;
    padding:150px; 
  }

  .card{
    outline: 20px;
    background-color: turquoise;
    outline-color: black;
  }

</style>

